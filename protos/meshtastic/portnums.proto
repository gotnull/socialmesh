syntax = "proto3";

package meshtastic;

option java_package = "com.geeksville.mesh";
option java_outer_classname = "Portnums";
option optimize_for = LITE_RUNTIME;

/*
 * Packet sent to/from the radio for configuration and data
 * Field numbers match official Meshtastic protobufs:
 * https://github.com/meshtastic/protobufs/blob/master/meshtastic/mesh.proto
 */

import "meshtastic/mesh.proto";

// Packets sent to the radio
message ToRadio {
  oneof payload_variant {
    // Send this packet on the mesh
    MeshPacket packet = 1;
    
    // Phone wants radio to send full node db to the phone.
    // The integer you write into this field will be reported back in the
    // config_complete_id response - allows clients to never be confused by
    // a stale old partially sent config.
    uint32 want_config_id = 3;
    
    // Tell API server we are disconnecting now.
    bool disconnect = 4;
    
    // Heartbeat message (keeps serial connections alive)
    Heartbeat heartbeat = 7;
  }
}

// Heartbeat message
message Heartbeat {
  uint32 nonce = 1;
}

// Packets received from radio
message FromRadio {
  // Packet ID for tracking
  uint32 id = 1;
  
  oneof payload_variant {
    // Received mesh packet
    MeshPacket packet = 2;
    
    // My node info - tells the phone what our node number is
    MyNodeInfo my_info = 3;
    
    // One packet is sent for each node in the on radio DB
    NodeInfo node_info = 4;
    
    // Include a part of the config
    Config config = 5;
    
    // Debug console output over protobuf stream
    LogRecord log_record = 6;
    
    // Sent as true once the device has finished sending all of the
    // responses to want_config - contains the config_id sent in wantConfigId
    uint32 config_complete_id = 7;
    
    // Sent to tell clients the radio has just rebooted
    bool rebooted = 8;
    
    // Include module config
    ModuleConfig moduleConfig = 9;
    
    // One packet is sent for each channel
    Channel channel = 10;
    
    // Queue status info
    QueueStatus queueStatus = 11;
    
    // Device metadata
    DeviceMetadata metadata = 13;
  }
}

// Log record for debug output
message LogRecord {
  enum Level {
    UNSET = 0;
    CRITICAL = 50;
    ERROR = 40;
    WARNING = 30;
    INFO = 20;
    DEBUG = 10;
    TRACE = 5;
  }
  
  string message = 1;
  fixed32 time = 2;
  string source = 3;
  Level level = 4;
}

// Queue status
message QueueStatus {
  int32 res = 1;
  uint32 free = 2;
  uint32 maxlen = 3;
  uint32 mesh_packet_id = 4;
}
